me:
  get:
    tags: [Users]
    summary: Get current authenticated user
    security:
      - bearerAuth: []
    responses:
      '200':
        description: Current user
        content:
          application/json:
            schema:
              $ref: ../schemas/user.yaml#/components/schemas/UserResponse
      '401':
        $ref: ../errors.yaml#/UnauthorizedError


  patch:
    tags: [Users]
    summary: Update current authenticated user
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: ../schemas/user.yaml#/components/schemas/UpdateMeRequest
    responses:
      '200':
        description: Updated user
        content:
          application/json:
            schema:
              $ref: ../schemas/user.yaml#/components/schemas/UserResponse
      '401':
        $ref: ../errors.yaml#/UnauthorizedError
      '422':
        $ref: ../errors.yaml#/ValidationError


me_update_password:
  patch:
    tags: [Users]
    summary: Change current user password
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: ../schemas/user.yaml#/components/schemas/UpdateMePasswordRequest
    responses:
      '200':
        description: Password changed
        content:
          application/json:
            schema:
              $ref: ../schemas/user.yaml#/components/schemas/UserResponse
      '401':
        $ref: ../errors.yaml#/UnauthorizedError
      '422':
        $ref: ../errors.yaml#/ValidationError

me_update_settings:
  patch:
    tags: [Users]
    summary: Update current user settings
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: ../schemas/user.yaml#/components/schemas/UpdateMeSettingsRequest
    responses:
      '204':
        description: Settings updated successfully (no response body)
      '401':
        $ref: ../errors.yaml#/UnauthorizedError
      '422':
        $ref: ../errors.yaml#/ValidationError

me_settings_stream:
  get:
    tags: [Users]
    summary: Stream current user settings updates (SSE)
    security:
      - bearerAuth: []
    responses:
      '200':
        description: Server-Sent Events stream with settings updates
        content:
          text/event-stream:
            schema:
              type: string
              example: |
                event: settings
                data: {"settings":{"theme":"dark"}}
      '401':
        $ref: ../errors.yaml#/UnauthorizedError

me_avatar:
  post:
    tags: [Users]
    summary: Upload current user avatar
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        multipart/form-data:
          schema:
            type: object
            required: [avatar]
            properties:
              avatar:
                type: string
                format: binary
    responses:
      '200':
        description: User with updated avatar
        content:
          application/json:
            schema:
              $ref: ../schemas/user.yaml#/components/schemas/UserResponse
      '401':
        $ref: ../errors.yaml#/UnauthorizedError
      '422':
        $ref: ../errors.yaml#/ValidationError

  delete:
    tags: [Users]
    summary: Delete current user avatar
    security:
      - bearerAuth: []
    responses:
      '200':
        description: User with removed avatar
        content:
          application/json:
            schema:
              $ref: ../schemas/user.yaml#/components/schemas/UserResponse
      '401':
        $ref: ../errors.yaml#/UnauthorizedError


admin_users:
  get:
    tags: [Admin Users]
    summary: List users (admin)
    security:
      - bearerAuth: []
    parameters:
      - name: page
        in: query
        required: false
        schema:
          type: integer
          minimum: 1
          example: 1
      - name: per_page
        in: query
        required: false
        schema:
          type: integer
          minimum: 1
          maximum: 100
          example: 20
      - name: search
        in: query
        required: false
        schema:
          type: string
          example: Иванов
        description: Search by email, first_name, last_name, middle_name, phone, role code or role label.
      - name: sort_by
        in: query
        required: false
        schema:
          type: string
          enum: [id, first_name, last_name, middle_name, created_at, name, access]
          example: last_name
      - name: sort_dir
        in: query
        required: false
        schema:
          type: string
          enum: [asc, desc]
          example: asc
    responses:
      '200':
        description: Paginated users list
        content:
          application/json:
            schema:
              $ref: ../schemas/user.yaml#/components/schemas/AdminUsersPaginatedResponse
      '401':
        $ref: ../errors.yaml#/UnauthorizedError
      '403':
        $ref: ../errors.yaml#/ForbiddenError

  post:
    tags: [Admin Users]
    summary: Create user (admin)
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: ../schemas/user.yaml#/components/schemas/CreateAdminUserRequest
    responses:
      '201':
        description: User created
        content:
          application/json:
            schema:
              type: object
              required: [status, message, data]
              properties:
                status:
                  type: string
                  example: ok
                message:
                  type: string
                  example: Created successfully
                data:
                  $ref: ../schemas/user.yaml#/components/schemas/User
      '401':
        $ref: ../errors.yaml#/UnauthorizedError
      '403':
        $ref: ../errors.yaml#/ForbiddenError
      '422':
        $ref: ../errors.yaml#/ValidationError


admin_users_by_id:
  parameters:
    - name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid

  get:
    tags: [Admin Users]
    summary: Get user by id (admin)
    security:
      - bearerAuth: []
    responses:
      '200':
        description: User details
        content:
          application/json:
            schema:
              type: object
              required: [status, user]
              properties:
                status:
                  type: string
                  example: ok
                user:
                  $ref: ../schemas/user.yaml#/components/schemas/User
      '401':
        $ref: ../errors.yaml#/UnauthorizedError
      '403':
        $ref: ../errors.yaml#/ForbiddenError
      '404':
        $ref: ../errors.yaml#/NotFoundError

  patch:
    tags: [Admin Users]
    summary: Update user (admin)
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: ../schemas/user.yaml#/components/schemas/UpdateAdminUserRequest
    responses:
      '200':
        description: User updated
        content:
          application/json:
            schema:
              type: object
              required: [status, message, data]
              properties:
                status:
                  type: string
                  example: ok
                message:
                  type: string
                  example: Updated successfully
                data:
                  $ref: ../schemas/user.yaml#/components/schemas/User
      '401':
        $ref: ../errors.yaml#/UnauthorizedError
      '403':
        $ref: ../errors.yaml#/ForbiddenError
      '404':
        $ref: ../errors.yaml#/NotFoundError
      '422':
        $ref: ../errors.yaml#/ValidationError

  delete:
    tags: [Admin Users]
    summary: Delete user (admin)
    security:
      - bearerAuth: []
    responses:
      '200':
        description: User deleted
        content:
          application/json:
            schema:
              type: object
              required: [status, message]
              properties:
                status:
                  type: string
                  example: ok
                message:
                  type: string
                  example: Deleted successfully
      '401':
        $ref: ../errors.yaml#/UnauthorizedError
      '403':
        $ref: ../errors.yaml#/ForbiddenError


admin_roles:
  get:
    tags: [Admin Roles]
    summary: List roles (admin)
    security:
      - bearerAuth: []
    responses:
      '200':
        description: Paginated roles list
        content:
          application/json:
            schema:
              type: object
              required: [status, data]
              properties:
                status:
                  type: string
                  example: ok
                data:
                  type: object
                  properties:
                    current_page:
                      type: integer
                      example: 1
                    data:
                      type: array
                      items:
                        $ref: ../schemas/role.yaml#/components/schemas/Role
      '401':
        $ref: ../errors.yaml#/UnauthorizedError
      '403':
        $ref: ../errors.yaml#/ForbiddenError

  post:
    tags: [Admin Roles]
    summary: Create role (admin)
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: ../schemas/role.yaml#/components/schemas/CreateRoleRequest
    responses:
      '201':
        description: Role created
        content:
          application/json:
            schema:
              type: object
              required: [status, message, data]
              properties:
                status:
                  type: string
                  example: ok
                message:
                  type: string
                  example: Created successfully
                data:
                  $ref: ../schemas/role.yaml#/components/schemas/Role
      '401':
        $ref: ../errors.yaml#/UnauthorizedError
      '403':
        $ref: ../errors.yaml#/ForbiddenError
      '422':
        $ref: ../errors.yaml#/ValidationError


admin_roles_by_id:
  parameters:
    - name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid

  get:
    tags: [Admin Roles]
    summary: Get role by id (admin)
    security:
      - bearerAuth: []
    responses:
      '200':
        description: Role details
        content:
          application/json:
            schema:
              type: object
              required: [status, role]
              properties:
                status:
                  type: string
                  example: ok
                role:
                  $ref: ../schemas/role.yaml#/components/schemas/Role
      '401':
        $ref: ../errors.yaml#/UnauthorizedError
      '403':
        $ref: ../errors.yaml#/ForbiddenError
      '404':
        $ref: ../errors.yaml#/NotFoundError

  patch:
    tags: [Admin Roles]
    summary: Update role (admin)
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: ../schemas/role.yaml#/components/schemas/UpdateRoleRequest
    responses:
      '200':
        description: Role updated
        content:
          application/json:
            schema:
              type: object
              required: [status, message, data]
              properties:
                status:
                  type: string
                  example: ok
                message:
                  type: string
                  example: Updated successfully
                data:
                  $ref: ../schemas/role.yaml#/components/schemas/Role
      '401':
        $ref: ../errors.yaml#/UnauthorizedError
      '403':
        $ref: ../errors.yaml#/ForbiddenError
      '422':
        $ref: ../errors.yaml#/ValidationError

  delete:
    tags: [Admin Roles]
    summary: Delete role (admin)
    security:
      - bearerAuth: []
    responses:
      '200':
        description: Role deleted
        content:
          application/json:
            schema:
              type: object
              required: [status, message]
              properties:
                status:
                  type: string
                  example: ok
                message:
                  type: string
                  example: Deleted successfully
      '401':
        $ref: ../errors.yaml#/UnauthorizedError
      '403':
        $ref: ../errors.yaml#/ForbiddenError
